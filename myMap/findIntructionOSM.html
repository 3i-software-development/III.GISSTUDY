<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Nearest Driving Route</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <button id="findRoute">Find Route</button>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
    var map = L.map('map').setView([51.505, -0.09], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var startPoint = L.latLng(51.505, -0.09);
    var endPoint = L.latLng(51.51, -0.1);
    
    var geojsonFeatures = [];

    var findRouteButton = document.getElementById("findRoute");
    findRouteButton.addEventListener("click", function () {
        var routeCoordinates = [];

        var routeControl = L.Routing.control({
            waypoints: [
                L.latLng(startPoint),
                L.latLng(endPoint)
            ],
            routeWhileDragging: true
        }).addTo(map);

        // routeControl.on('routesfound', function(e) {
        //     var routes = e.routes;
        //     if (routes.length > 0) {
                
        //         var route = routes[0];
        //         var coordinates = [];
        //         route.coordinates.forEach(function(coord) {
        //             coordinates.push([coord.lat, coord.lng]);
        //         });
        //         routeCoordinates = coordinates;
        //         var instructions = route.instructions;
        //         instructions.forEach(function(instruction) {
        //             instruction.latLng = route.coordinates[instruction.index];
        //         });
        //         //saveRouteToGeoJSON(routeCoordinates);
                
        //         //saveInstructionsToGeoJSON(instructions);
        //     }
        // });

        // function saveInstructionsToGeoJSON(instructions) {
            
        //     var geojsonFeatures = [];
        //     for (var i = 0; i < instructions.length; i++) {
        //         var instruction = instructions[i];
        //         var geojsonFeature = {
        //             type: "Feature",
        //             properties: {
        //                 type: instruction.type,
        //                 distance: instruction.distance,
        //                 time: instruction.time,
        //                 road: instruction.road,
        //                 direction: instruction.direction,
        //                 modifier: instruction.modifier,
        //                 text: instruction.text
        //             },
        //             geometry: {
        //                 type: "Point",
        //                 coordinates: [instruction.latLng.lng, instruction.latLng.lat]
        //             }
        //         };
        //         geojsonFeatures.push(geojsonFeature);
        //     }
        //     var geojsonObject = {
        //         type: "FeatureCollection",
        //         features: geojsonFeatures
        //     };
            
        //     var geojsonString = JSON.stringify(geojsonObject, null, 2);

            

        //     var blob = new Blob([geojsonString], { type: "application/json" });
        //     var url = URL.createObjectURL(blob);

        //     var a = document.createElement("a");
        //     a.style.display = "none";
        //     a.href = url;
        //     a.download = "instruction.geojson";
        //     document.body.appendChild(a);
        //     a.click();

        //     URL.revokeObjectURL(url);
        // }

    });
});

    </script>
</body>
</html>
