<!DOCTYPE html>
<html>
<head>
    <title>Map Example</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.0/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.0/dist/MarkerCluster.Default.css" />
    <style>
        #map {
            height: 700px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.0/dist/leaflet.markercluster.js"></script>
    <script>
        var map = L.map('map').setView([0, 0], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        // Tạo một đa giác (polygon)
        var polygonCoordinates = [
            [0, 0],
            [0, 10],
            [10, 10],
            [10, 0]
        ];
        var polygon = L.polygon(polygonCoordinates).addTo(map);

        // Tạo danh sách tọa độ ngẫu nhiên bên trong polygon
        var markerCoordinates = [];
        var numberOfMarkers = 1000;
        var markers = L.markerClusterGroup();

        
        for (var i = 0; i < numberOfMarkers; i++) {
            // Tạo tọa độ ngẫu nhiên bên trong polygon
            var lat = Math.random() * 10;
            var lng = Math.random() * 10;
            var randomCoord = [lat, lng];

            // Kiểm tra xem tọa độ nằm trong polygon
            if (polygon.getBounds().contains(randomCoord)) {
                markerCoordinates.push(randomCoord);
            }
        }

        // Tạo và thêm các marker vào Cluster Group
        markerCoordinates.forEach(function(coord) {
            var marker = L.marker(coord);
            markers.addLayer(marker);
        });

        map.addLayer(markers);

        map.on('zoomend', function() {
            var currentZoom = map.getZoom();

            // Lọc danh sách marker dựa trên zoom level
            var filteredMarkers = markerCoordinates.filter(function(coord) {
                // Thêm điều kiện lọc dựa trên currentZoom nếu cần
                return true;
            });

            // Xóa tất cả marker khỏi Cluster Group
            markers.clearLayers();

            // Thêm lại các marker phù hợp vào Cluster Group
            filteredMarkers.forEach(function(coord) {
                var marker = L.marker(coord);
                markers.addLayer(marker);
            });
        });
    </script>
</body>
</html>
